<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<title>Document</title>
	<link rel="stylesheet" href="./css/left_menus.css">
</head>
<body>
	<!-- 左侧导航菜单 -->
<div class="left-menu">
    <div class="menu-header">
        <div class="menu-title line-hide">
            <i class="menu-title-icon md md-dashboard"></i>
            <span class="menu-title-text">自定义栏目</span>
        </div>
    </div>
    <div class="menu-content">
        <ul class="menu-lists list-unstyled" data-level="1" menu-type="group">
          <li menu-type="item">
            <div class="lists-title line-hide" data-status="open">
              <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
              <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义专题1</a>
            </div>
            <ul class="menu-lists list-unstyled" data-level="2" menu-type="group">
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="open">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题1</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li menu-type="item">
            <div class="lists-title line-hide" data-status="close">
              <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
              <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义专题2</a>
            </div>
            <ul class="menu-lists list-unstyled" data-level="2" menu-type="group">
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="open">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题1</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
              <li menu-type="item">
                <div class="lists-title line-hide" data-status="close">
                  <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                  <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题4</a>
                </div>
                <ul class="menu-lists list-unstyled" data-level="3" menu-type="group">
                  <li menu-type="item">
                    <div class="lists-title line-hide active" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题2</a>
                    </div>
                  </li>
                  <li menu-type="item">
                    <div class="lists-title line-hide" data-status="over">
                      <i class="list-title-icon" menu-oper="toggle" title="展开"></i>
                      <a class="lists-title-link" href="javascript:;" title="自定义专题">自定义子专题3</a>
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
    </div>
</div>
<script src="./js/jquery.min.js"></script>
<script>
(function(win,$,undefined) {

  /**
   * 切换状态
   * @param  {[type]} $dom [description]
   * @param  {[type]} val  [description]
   * @return {[type]}      [description]
   */
  function statusChange($dom, val) {
    $dom.attr('data-status', val).data('status', val);
  }

  /**
   * 关闭指定菜单及该菜单下的所有子级菜单
   * @param  {Object} $dom [需要关闭菜单的 jquery dom 对象]
   * @return {undefined}      
   */
  function closedMenu($dom) {

    
    // $dom.data('status', 'close');
    // $dom.attr('data-status',"close");
    statusChange($dom, 'close');
    var $menuChild = filterChildMenu($dom),
        $openItems = null;
    // $menuChild = $parent.next('[menu-type="group"]');
    if(!$menuChild) {
      return;
    }

    $openItems = $menuChild.find('[data-status="open"]');
    if($openItems.length === 0) {
      return;
    }
    Array.prototype.forEach.call($openItems,function(item) {
      // $(item).data('status','close');
      // $(item).attr('data-status',"close");
      statusChange($(item), 'close');
    });
    


    // console.info($menuChild);
  }
  /**
   * 打开指定菜单
   * @param  {Object} $dom [需要打开的菜单]
   * @return {[type]}      [description]
   */
  function openTheMenu($dom) {
    // 先关闭其他已经打开的菜单，如果有的话

    // 查找同级菜单
    
    var $menuItem = $dom.parent(),
        $siblingMenus = $menuItem.siblings();
    Array.prototype.some.call($siblingMenus,function(dom) {
      var $item = $(dom),
          $menuTitle = $item.find('[data-status="open"]');
      // console.info(dom);
      // 没有找到则进入下次循环
      if($menuTitle.length === 0) {
        return false;
      }

      // // 查看是否有子级菜单，没有则退出
      // $menuChild = filterChildMenu($menuTitle);
      // if(!$menuChild) {
      //   return true;
      // }
      closedMenu($menuTitle);
      return true;
    });
    // $dom.attr('data-status', 'open');
    statusChange($dom, 'open');
  }

  /**
   * 筛选子级菜单
   * @param  {Object} $dom [当前菜单项的 jquery dom 对象]
   * @return {Object}      [如果找到则返回jquery对象，如果没有找到则返回null]
   */
  function filterChildMenu($dom) {
    var $menu = $dom.next('[menu-type="group"]');
    return $menu.length === 0 ? null : $menu;
  }
  // console.info(arguments);
  var $menus = $('.menu-content');
  $menus.on('click', '[menu-oper="toggle"]', function(event) {
    var self = this,
        $self = $(self),
        $selfMenuTitle = $self.parent(),
        menuStatus = $selfMenuTitle.data('status');

// 三种状态，展开|关闭|结束
    // 菜单结束时退出程序
    if(menuStatus === "over") {
      return;
    }
    //  else if(menuStatus === "open") { // 如果展开，则关闭
    // } else if (menuStatus === "") { // 如果关闭，则展开
    // }
    

    menuStatus === "close" ? openTheMenu($selfMenuTitle) : closedMenu($selfMenuTitle);
    
    
  })
})(window,jQuery);
</script>
</body>
</html>